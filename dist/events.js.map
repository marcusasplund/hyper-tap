{"version":3,"file":"events.js","sources":["../src/events.js"],"sourcesContent":["var eventCache = []\n\nexport function defineEvents(options) {\n  if (Array.isArray(options)) {\n    options.forEach(function(event) {\n      eventCache.push(event)\n    })\n  } else {\n    eventCache.push({\n      event: options.event,\n      element: options.element,\n      targetEl: options.targetEl,\n      callback: options.callback\n    })\n  }\n}\n\nexport function bindEvents(model, actions) {\n\n  // Event delegator:\n  function delegate(element, event, targetEl, callback) {\n    var delegateEl\n    if (!element) element = 'body'\n    if (typeof element === 'string') {\n      delegateEl = document.querySelector(element)\n    } else if (element.nodeName) {\n      delegateEl = element\n    }\n    var eventListener = function(e) {\n      var target = e.target\n      var elements = Array.prototype.slice.apply(delegateEl.querySelectorAll(targetEl))\n      do {\n        var len = elements.length\n        for (var i = 0; i < len; i++) {\n          if (target === elements[i]) {\n            callback.call(elements[i], e, model, actions)\n            break\n          }\n        }\n      } while (target = target.parentNode)\n    }\n    delegateEl.addEventListener(event, eventListener);\n  }\n\n  eventCache.forEach(function(evt) {\n    var el\n    if (typeof evt.element === 'string') {\n      el = document.querySelector(evt.element)\n    } else {\n      el = document.querySelector('body')\n    }\n    if (evt.targetEl) {\n      delegate(evt.element, evt.event, evt.targetEl, evt.callback);\n    } else {\n      var callback = function(e) {\n        evt.callback.call(el, e, model, actions);\n      }\n      el.addEventListener(evt.event, callback);\n    }\n  })\n}\n\nexport function unBindEvent(target, event, callback) {\n  if (eventCache && eventCache.length) {\n    var position = eventCache.findIndex(function(event) {\n      event.target === target\n    });\n    var element = document.querySelector(target)\n    element.removeEventListener(event, this[callback])\n    eventCache.splice(position, 1);\n  }\n}\n\n//////////////////////////////\n// GESTURES:\n//////////////////////////////\n/**\n * Event aliases for desktop and mobile:\n */\nvar eventStart = 'ontouchstart' in window && /mobile/img.test(navigator.userAgent) ? 'touchstart' : 'mousedown'\nvar eventEnd = 'ontouchstart' in window && /mobile/img.test(navigator.userAgent) ? 'touchend' : 'click'\nvar eventMove = 'ontouchstart' in window && /mobile/img.test(navigator.userAgent) ? 'touchmove' : 'mousemove'\nvar eventCancel = 'ontouchstart' in window && /mobile/img.test(navigator.userAgent) ? 'touchcancel' : 'mouseout'\n\n\n//Ready event:\nfunction ready(callback) {\n  if (document.readyState !== 'loading') {\n    callback.call(callback)\n  } else {\n    document.addEventListener(\"DOMContentLoaded\", function() {\n      return callback.call(callback)\n    })\n  }\n}\n\n// Delegate Events:\nfunction delegateTheEvent(options) {\n  var element = options.element\n  var root = options.root || document.body\n  var type = options.type\n  var callback = options.callback\n  if (typeof root === 'string') root = document.querySelector(root)\n  var eventListener = function(e) {\n    var target = e.target\n    var elements\n    if (element.nodeType) elements = [element]\n    else elements = Array.prototype.slice.apply(root.querySelectorAll(element))\n    do {\n      var len = elements.length\n      for (var i = 0; i < len; i++) {\n        if (target === elements[i]) {\n          callback.call(elements[i], e)\n          break\n        }\n      }\n    } while (target = target.parentNode)\n  }\n  root.addEventListener(type, eventListener)\n}\n\n// Fire gesture on element:\nfunction trigger(el, event, data) {\n  if (!event) {\n    console.error(errors.noEventToTrigger)\n    return;\n  }\n  if (document.createEvent) {\n    var evtObj = document.createEvent('Events')\n    evtObj.initEvent(event, true, false)\n    evtObj.data = data\n    el.dispatchEvent(evtObj)\n  }\n}\n\nvar enableGestures = function() {\n  var touch = {}\n  var touchTimeout\n  var swipeTimeout\n  var tapTimeout\n  var longTapDelay = 750\n  var singleTapDelay = 150\n  var gestureLength = 20\n  if (/android/img.test(navigator.userAgent)) singleTapDelay = 200\n  var longTapTimeout\n\n  function parentIfText(node) {\n    return 'tagName' in node ? node : node.parentNode\n  }\n\n  function swipeDirection(x1, x2, y1, y2) {\n    return Math.abs(x1 - x2) >=\n      Math.abs(y1 - y2) ? (x1 - x2 > 0 ? 'left' : 'right') : (y1 - y2 > 0 ? 'up' : 'down')\n  }\n\n  function longTap() {\n    longTapTimeout = null;\n    if (touch.last) {\n      try {\n        if (touch && touch.el) {\n          trigger(touch.el, 'longtap')\n          touch = {}\n        }\n      } catch (err) {}\n    }\n  }\n\n  function cancelLongTap() {\n    if (longTapTimeout) clearTimeout(longTapTimeout)\n    longTapTimeout = null\n  }\n\n  function cancelAll() {\n    if (touchTimeout) clearTimeout(touchTimeout)\n    if (tapTimeout) clearTimeout(tapTimeout)\n    if (swipeTimeout) clearTimeout(swipeTimeout)\n    if (longTapTimeout) clearTimeout(longTapTimeout)\n    touchTimeout = tapTimeout = swipeTimeout = longTapTimeout = null\n    touch = {}\n  }\n\n  /**\n   * Execute this after DOM loads:\n   */\n  (function() {\n    var now\n    var delta\n    var body = document.body\n    var twoTouches = false\n\n    /**\n     * Capture start of event:\n     */\n    body.addEventListener(eventStart, function(e) {\n      now = Date.now()\n      delta = now - (touch.last || now)\n      if (e.originalEvent) e = e.originalEvent\n\n      if (eventStart === 'mousedown') {\n        touch.el = parentIfText(e.target)\n        if (e.target.nodeName === 'ripple') {\n          touch.el = el.target.parentNode\n        }\n        touchTimeout && clearTimeout(touchTimeout)\n        touch.x1 = e.pageX\n        touch.y1 = e.pageY\n        twoTouches = false\n\n      /**\n       * Detect two or more finger gestures:\n       */\n      } else {\n        if (e.touches.length === 1) {\n          if (!!e.target.disabled) return\n          touch.el = parentIfText(e.touches[0].target)\n          touchTimeout && clearTimeout(touchTimeout)\n          touch.x1 = e.touches[0].pageX\n          touch.y1 = e.touches[0].pageY\n          if (e.targetTouches.length === 2) {\n            twoTouches = true\n          } else {\n            twoTouches = false\n          }\n        }\n      }\n\n      if (delta > 0 && delta <= 450) {\n        touch.isDoubleTap = true\n      }\n      touch.last = now\n      longTapTimeout = setTimeout(longTap, longTapDelay)\n    });\n\n    /**\n     * Capture event move:\n     */\n    body.addEventListener(eventMove, function(e) {\n      if (e.originalEvent) e = e.originalEvent\n      cancelLongTap()\n      if (eventMove === 'mousemove') {\n        touch.x2 = e.pageX\n        touch.y2 = e.pageY\n      } else {\n        /**\n         * One finger gesture:\n         */\n        if (e.touches.length === 1) {\n          touch.x2 = e.touches[0].pageX\n          touch.y2 = e.touches[0].pageY\n          touch.move = true\n        }\n      }\n    });\n\n    /**\n     * Capture event end:\n     */\n    body.addEventListener(eventEnd, function(e) {\n\n      cancelLongTap()\n      if (!!touch.el) {\n        /**\n         * Swipe detection:\n         */\n        if ((touch.x2 && Math.abs(touch.x1 - touch.x2) > gestureLength) ||\n          (touch.y2 && Math.abs(touch.y1 - touch.y2) > gestureLength)) {\n          swipeTimeout = setTimeout(function() {\n            if (touch && touch.el) {\n              trigger(touch.el, 'swipe')\n              trigger(touch.el, 'swipe' + (swipeDirection(touch.x1, touch.x2, touch.y1, touch.y2)))\n              touch = {}\n            }\n          }, 0);\n\n        /**\n         * Normal tap:\n         */\n        } else if ('last' in touch) {\n          /**\n           * Delay by one tick so we can cancel the 'tap' event if 'scroll' fires:\n           */\n          tapTimeout = setTimeout(function() {\n            /**\n             * Trigger double tap immediately:\n             */\n            if (touch && touch.isDoubleTap) {\n              if (touch && touch.el) {\n                trigger(touch.el, 'doubletap')\n                e.preventDefault();\n                touch = {}\n              }\n\n            } else {\n              /**\n               * Trigger tap after singleTapDelay:\n               */\n              touchTimeout = setTimeout(function() {\n                touchTimeout = null\n                if (touch && touch.el && !touch.move) {\n                  trigger(touch.el, 'tap')\n                  touch = {}\n\n                } else {\n                  /**\n                   * Touch moved so cancel tap:\n                   */\n                  cancelAll()\n                }\n              }, singleTapDelay)\n            }\n          }, 0)\n        }\n\n      } else {\n        return\n      }\n    });\n    body.addEventListener('touchcancel', cancelAll)\n  })()\n}\nenableGestures()\n"],"names":["defineEvents","options","Array","isArray","forEach","event","eventCache","push","element","targetEl","callback","bindEvents","model","actions","delegate","delegateEl","document","querySelector","nodeName","eventListener","e","target","elements","prototype","slice","apply","querySelectorAll","len","length","i","call","parentNode","addEventListener","evt","el","unBindEvent","position","findIndex","removeEventListener","this","splice","trigger","data","console","error","errors","noEventToTrigger","createEvent","evtObj","initEvent","dispatchEvent","eventStart","window","test","navigator","userAgent","eventEnd","eventMove","parentIfText","node","swipeDirection","x1","x2","y1","y2","Math","abs","longTap","longTapTimeout","touch","last","err","cancelLongTap","clearTimeout","cancelAll","touchTimeout","tapTimeout","swipeTimeout","singleTapDelay","now","delta","body","twoTouches","Date","originalEvent","pageX","pageY","touches","disabled","targetTouches","isDoubleTap","setTimeout","move","preventDefault"],"mappings":"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"}